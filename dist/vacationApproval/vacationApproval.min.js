/*! node-form-app 29-07-2014 */
var VacationApproval;!function(a){var b=function(){function a(){this.tagName="dateCompareExt"}return a.prototype.isAcceptable=function(a){if(!_.isDate(a))return!1;var b=moment(a);void 0==this.From&&(this.From=new Date);var c=moment(this.From);void 0==this.To&&(this.To=new Date);var d=moment(this.To),e=this.isValid(c,b,this.FromOperator)&&this.isValid(d,b,this.ToOperator);return e},a.prototype.isValid=function(a,b,c){var d=!1;this.IgnoreTime&&(b=b.startOf("day"),a=a.startOf("day"));var e=b.diff(a);return this.IgnoreTime&&(e=moment.duration(e).days()),d=0>e?0==c||1==c||3==c:e>0?5==c||4==c||3==c:1==c||2==c||4==c},a.prototype.customMessage=function(a,b){var c=a.Msg,d=a.Format;return void 0!=d&&_.extend(b,{FormatedFrom:moment(b.From).format(d),FormatedTo:moment(b.To).format(d),FormatedAttemptedValue:moment(b.AttemptedValue).format(d)}),c=c.replace("From","FormatedFrom"),c=c.replace("To","FormatedTo"),c=c.replace("AttemptedValue","FormatedAttemptedValue"),Validation.StringFce.format(c,b)},a}();a.FromToDateValidator=b}(VacationApproval||(VacationApproval={}));var VacationApproval;!function(a){var b=function(){function b(a,b){this.Data=a,this.vacationDeputyService=b,this.MainValidator=this.createMainValidator().CreateRule("Data"),this.EmployeeValidator=this.MainValidator.Children.Employee,this.Deputy1Validator=this.MainValidator.Children.Deputy1,this.Deputy2Validator=this.MainValidator.Children.Deputy2,this.DurationValidator=this.MainValidator.Children.Duration,this.DeputyConflictsValidator=this.MainValidator.Validators.DeputyConflict,this.EmployeeValidator.Rules.Email.Optional=function(){return void 0==this.Email||!this.Email.Checked}.bind(this.Data.Employee),this.Deputy2Validator.SetOptional(function(){return void 0==this.Deputy2||!this.Deputy2.Checked}.bind(this.Data)),this.Errors=this.MainValidator.ValidationResult}return b.prototype.Validate=function(){this.MainValidator.ValidateAll(this.Data),this.DeputyConflictsValidator.ValidateAsync(this.Data)},b.prototype.createMainValidator=function(){var a=new Validation.AbstractValidator,b=this.createPersonValidator();a.ValidatorFor("Employee",b),a.ValidatorFor("Deputy1",b),a.ValidatorFor("Deputy2",b);var c=this.createDurationValidator();a.ValidatorFor("Duration",c);var d=this.vacationDeputyService,e=function(a){var b=Q.defer();return d.isAcceptable(this).then(function(c){a.HasError=!1,a.ErrorMessage="",c||(a.HasError=!0,a.ErrorMessage="Deputies conflict. Select another deputy."),b.resolve(void 0)}),b.promise},f={Name:"DeputyConflict",AsyncValidationFce:e};return a.ValidationFor("DeputyConflict",f),a},b.prototype.createDurationValidator=function(){var b=new Validation.AbstractValidator,c=new Validation.RequiredValidator,d=new a.FromToDateValidator;d.FromOperator=4,d.From=new Date,d.ToOperator=1,d.To=moment(new Date).add({year:1}).toDate(),d.IgnoreTime=!0,b.RuleFor("From",c),b.RuleFor("To",c),b.RuleFor("From",d),b.RuleFor("To",d);var e=function(a,b){var c=a.Msg,d=a.Format;return void 0!=d&&_.extend(b,{FormatedFrom:moment(b.From).format(d),FormatedTo:moment(b.To).format(d),FormatedAttemptedValue:moment(b.AttemptedValue).format(d)}),c=c.replace("From","FormatedFrom"),c=c.replace("To","FormatedTo"),c=c.replace("AttemptedValue","FormatedAttemptedValue"),Validation.StringFce.format(c,b)},f=function(a){if(a.HasError=!1,a.ErrorMessage="",_.isDate(this.From)&&_.isDate(this.To)){var b=moment(this.To).clone();if(moment(this.From).startOf("day").isAfter(moment(b).add({days:-1}).startOf("day")))return a.HasError=!0,a.ErrorMessage=e({Msg:"Date from '{From}' must be before date to '{To}'.",Format:"MM/DD/YYYY"},this),void(a.TranslateArgs={TranslateId:"BeforeDate",MessageArgs:this,CustomMessage:e});var c=30;if(moment(this.To).startOf("day").diff(moment(this.From).startOf("day"),"days")>c){a.HasError=!0;var d={MaxDays:c};a.ErrorMessage=Validation.StringFce.format("Maximal vacation duration is {MaxDays}'.",d),a.TranslateArgs={TranslateId:"MaxDuration",MessageArgs:d}}}},g={Name:"VacationDuration",ValidationFce:f};return b.ValidationFor("From",g),b.ValidationFor("To",g),b},b.prototype.createPersonValidator=function(){var a=new Validation.AbstractValidator,b=new Validation.RequiredValidator,c=new Validation.EmailValidator,d=new Validation.MaxLengthValidator;return d.MaxLength=15,a.RuleFor("FirstName",b),a.RuleFor("FirstName",d),a.RuleFor("LastName",b),a.RuleFor("LastName",d),a.RuleFor("Email",b),a.RuleFor("Email",c),a},b}();a.BusinessRules=b}(VacationApproval||(VacationApproval={}));